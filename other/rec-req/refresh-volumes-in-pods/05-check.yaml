apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- command: sleep 5
- script: |
    val=$(kubectl exec pod01 -n refresh-vols-ns -- cat /mnt/foo/foo)
    if [ "$val" = "bar" ]; then exit 0; else exit 1; fi
- script: |
    val=$(kubectl exec pod02 -n refresh-vols-ns -- cat /mnt/foo/foo)
    if [ "$val" = "bar" ]; then exit 0; else exit 1; fi
- script: |
    val=$(kubectl exec pod04 -n refresh-vols-ns -- cat /mnt/foo/foo)
    if [ "$val" = "bar" ]; then exit 0; else exit 1; fi
- command: kubectl delete pod --all --force --grace-period=0 -n refresh-vols-ns
- command: kubectl delete cm --all --force --grace-period=0 -n refresh-vols-ns
- command: kubectl delete clusterrole kyverno:background-controller:refresh-vols-pods
- command: kubectl delete cpol --all
- command: sleep 3
- command: kubectl delete ns refresh-vols-ns