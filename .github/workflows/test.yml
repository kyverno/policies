# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: E2E Tests

permissions: {}

on:
  pull_request:
    branches:
      - main
      - release-*

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:

  argo:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: argo

  argo-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: argo-cel

  karpenter-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: karpenter-mpol

  aws:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: aws

  aws-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: aws-cel

  best-practices:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: best-practices
        shard-index: ${{ matrix.shard-index }}
        shard-count: 2

  best-practices-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: best-practices-cel
        shard-index: ${{ matrix.shard-index }}
        shard-count: 2

  best-practices-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: best-practices-mpol

  best-practices-gpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: best-practices-gpol
        shard-index: ${{ matrix.shard-index }}
        shard-count: 2

  castai:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: castai

  castai-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: castai-mpol

  cert-manager:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: cert-manager

  cleanup:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: cleanup

  cleanup-dpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: cleanup-dpol

  consul:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: consul

  consul-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: consul-cel

  external-secret-operator:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: external-secret-operator

  flux:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: flux

  flux-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: flux-cel

  istio:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: istio

  istio-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: istio-cel

  istio-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: istio-mpol

  karpenter:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: karpenter

  kasten:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kasten

  kasten-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kasten-cel

  kubecost:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kubecost

  kubecost-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kubecost-cel

  kubecost-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kubecost-mpol

  kubeops:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kubeops

  kubevirt:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kubevirt

  kubevirt-gpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: kubevirt-gpol

  linkerd:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: linkerd

  linkerd-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: linkerd-cel

  linkerd-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: linkerd-mpol

  nginx-ingress:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: nginx-ingress

  nginx-ingress-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: nginx-ingress-cel

  openshift:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: openshift

  openshift-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: openshift-cel

  other:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2,3,4,5,6,7,8]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: other
        shard-index: ${{ matrix.shard-index }}
        shard-count: 9
  
  other-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2,3,4,5,6,7,8]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: other-mpol
        shard-index: ${{ matrix.shard-index }}
        shard-count: 9

  other-vpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2,3,4,5,6,7,8]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: other-vpol
        shard-index: ${{ matrix.shard-index }}
        shard-count: 9

  other-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2,3,4,5,6,7,8]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: other-cel
        shard-index: ${{ matrix.shard-index }}
        shard-count: 9

  other-gpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2,3,4,5,6,7,8]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: other-gpol
        shard-index: ${{ matrix.shard-index }}
        shard-count: 9

  pod-security:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: pod-security
        shard-index: ${{ matrix.shard-index }}
        shard-count: 3

  pod-security-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
        shard-index: [0,1,2]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: pod-security-cel
        shard-index: ${{ matrix.shard-index }}
        shard-count: 3

  psa:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: psa

  psa-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: psa-cel

  psa-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: psa-mpol

  psp-migration:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: psp-migration

  psp-migration-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: psp-migration-cel

  psp-migration-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: psp-migration-mpol

  tekton:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: tekton

  tekton-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: tekton-cel

  traefik:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: traefik

  traefik-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: traefik-cel

  velero:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: velero

  velero-cel:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: velero-cel

  velero-mpol:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: velero-mpol

  windows-security:
    strategy:
      fail-fast: false
      matrix:
        k8s-version: [v1.30.13, v1.31.9, v1.32.5, v1.33.1]
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
    - name: Setup Environment
      uses: ./.github/actions/setup-env
      with:
        k8s-version: ${{ matrix.k8s-version }}
    - name: Run Tests
      uses: ./.github/actions/run-tests
      with:
        path: windows-security

  e2e-required-success:
    name: e2e-required
    needs:
    - argo
    - argo-cel
    - aws
    - aws-cel
    - best-practices
    - best-practices-cel
    - best-practices-mpol
    - best-practices-gpol
    - castai
    - castai-mpol
    - cert-manager
    - cleanup
    - cleanup-dpol
    - consul
    - consul-cel
    - external-secret-operator
    - flux
    - flux-cel
    - istio
    - istio-cel
    - istio-mpol
    - karpenter
    - kasten
    - kasten-cel
    - kubecost
    - kubecost-cel
    - kubecost-mpol
    - kubeops
    - kubevirt
    - kubevirt-gpol
    - linkerd
    - linkerd-cel
    - linkerd-mpol
    - nginx-ingress
    - nginx-ingress-cel
    - openshift
    - openshift-cel
    - other
    - other-vpol
    - other-mpol
    - other-cel
    - other-gpol
    - pod-security
    - pod-security-cel
    - psa
    - psa-cel
    - psa-mpol
    - psp-migration
    - psp-migration-cel
    - psp-migration-mpol
    - tekton
    - tekton-cel
    - traefik
    - traefik-cel
    - velero
    - velero-cel
    - velero-mpol
    - windows-security
    runs-on: ubuntu-latest
    if: ${{ success() }}
    steps:
    - run: ${{ true }}

  e2e-required-failure:
    name: e2e-required
    needs:
    - argo
    - argo-cel
    - aws
    - aws-cel
    - best-practices
    - best-practices-cel
    - best-practices-mpol
    - best-practices-gpol
    - castai
    - castai-mpol
    - cert-manager
    - cleanup
    - cleanup-dpol
    - consul
    - consul-cel
    - external-secret-operator
    - flux
    - flux-cel
    - istio
    - istio-cel
    - istio-mpol
    - karpenter
    - karpenter-mpol
    - kasten
    - kasten-cel
    - kubecost
    - kubecost-cel
    - kubecost-mpol
    - kubeops
    - kubevirt
    - kubevirt-gpol
    - linkerd
    - linkerd-cel
    - linkerd-mpol
    - nginx-ingress
    - nginx-ingress-cel
    - openshift
    - openshift-cel
    - other
    - other-vpol
    - other-mpol
    - other-cel
    - other-gpol
    - pod-security
    - pod-security-cel
    - psa
    - psa-cel
    - psa-mpol
    - psp-migration
    - psp-migration-cel
    - psp-migration-mpol
    - tekton
    - tekton-cel
    - traefik
    - traefik-cel
    - velero
    - velero-cel
    - velero-mpol
    - windows-security
    runs-on: ubuntu-latest
    if: ${{ failure() || cancelled() }}
    steps:
    - run: ${{ false }}
