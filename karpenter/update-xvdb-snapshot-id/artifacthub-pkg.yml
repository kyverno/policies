name: update-xvdb-snapshot-id
version: 1.0.0
displayName: Update /dev/xvdb snapshot ID in Karpenter EC2NodeClass
createdAt: "2024-12-19T10:00:00.000Z"
description: >-
  This policy automatically updates the snapshot ID for the /dev/xvdb device
  in Karpenter EC2NodeClass resources. It ensures that the block device mapping
  for /dev/xvdb uses a specified snapshot ID, which is useful for standardizing
  EBS volumes across EC2 instances provisioned by Karpenter. The policy handles
  both existing block device mappings and creates new ones if needed.
install: |-
  ```shell
  kubectl apply -f https://raw.githubusercontent.com/kyverno/policies/main/karpenter/update-xvdb-snapshot-id/update-xvdb-snapshot-id.yaml
  ```
keywords:
  - kyverno
  - Karpenter
  - EBS
  - EC2NodeClass
readme: |
  This policy automatically updates the snapshot ID for the /dev/xvdb device
  in Karpenter EC2NodeClass resources. It ensures that the block device mapping
  for /dev/xvdb uses a specified snapshot ID, which is useful for standardizing
  EBS volumes across EC2 instances provisioned by Karpenter.

  The policy includes two rules:
  1. Updates existing /dev/xvdb block device mappings with the specified snapshot ID
  2. Creates a new block device mapping for /dev/xvdb if one doesn't exist

  **Configuration**: Update the `snapshotId` variable in the policy with your desired snapshot ID.
  
  Refer to the documentation for more details on Kyverno annotations: https://artifacthub.io/docs/topics/annotations/kyverno/
annotations:
  kyverno/category: "Karpenter"
  kyverno/kubernetesVersion: "1.26"
  kyverno/subject: "EC2NodeClass" 